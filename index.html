<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mark</title>
  <link rel="stylesheet" href="style.css" />
  <script src="./api/marked.min.js"></script>
  <link rel="stylesheet" href="./api/katex.min.css">
</head>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({ startOnLoad: false });
</script>
<script defer src="./api/katex.min.js"></script>
<script defer src="./api/auto-render.min.js"
        onload="renderMathInElement(document.body, {
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false}
          ],
          throwOnError: false,
          output: 'html',
          trust: true
        });">
</script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    function adjustKatexFormulas() {
      const katexDisplays = document.querySelectorAll('.katex-display');
      katexDisplays.forEach(display => {
        display.style.maxWidth = '100%';
        display.style.overflowX = 'auto';
      });
    }
    
    adjustKatexFormulas();
    window.addEventListener('resize', adjustKatexFormulas);
  });
</script>
<body>
  <div id="main">
    <div id="navbar">
        <img id="logo" src="./images/logo_white.png" alt="Logo" />
        <span id="title">*</span>
        <div id="toolbar">
          <div id="dropdown-title" class="dropdown">
            <button id="btn-title" title="Title">#</button>
            <div id="dropdown-content" class="dropdown-content">
              <button class="dropdown-item" data-level="1">Title 1</button>
              <button class="dropdown-item" data-level="2">Title 2</button>
              <button class="dropdown-item" data-level="3">Title 3</button>
            </div>
          </div>
          <button id="btn-bold" title="Bold"><b>B</b></button>
          <button id="btn-italic" title="Italic"><i>I</i></button>
          <button id="btn-hr" title="Line">―</button>
          <button id="btn-code" title="Code">{ }</button>
          <button id="btn-link" title="Link">🔗</button>
          <button id="btn-image" title="Image">🖼️</button>
          <button id="btn-ul" title="Pointer List">• List</button>
          <button id="btn-ol" title="Numeric List">1. List</button>
          <button id="btn-underline" title="Underline"><u>U</u></button>
          <!-- Visualizzazione: solo editor, solo preview, split-view -->
          <div id="view-modes" style="display:inline-block; margin-left:16px;">
            <button id="btn-view-editor" title="Solo Editor" style="font-weight:bold;">📝</button>
            <button id="btn-view-preview" title="Solo Preview" style="font-weight:bold;">👁️</button>
            <button id="btn-view-split" title="Split View" style="font-weight:bold;">🔀</button>
          </div>
          <label id="autosave-switch" style="margin-left:16px; font-size:14px; display:inline-flex; align-items:center; gap:4px; cursor:pointer;">
            <span style="margin-right:4px;">Autosave</span>
            <span class="switch">
              <input type="checkbox" id="toggle-autosave" style="display:none;" />
              <span class="slider"></span>
            </span>
          </label>
        </div>
    </div>
    <div id="search-container" class="hidden">
      <input type="text" id="search-input" placeholder="Search..." />
      <div id="search-buttons">
        <button id="search-button" title="Search">&rarr;</button>
        <button id="search-prev" title="Previous">&uarr;</button>
        <button id="search-next" title="Next">&darr;</button>
        <button id="search-close" title="Close">✕</button>
      </div>
      <span id="search-results">0/0</span>
    </div>
    <div id="app-container">
      <div id="explorer-panel">
        <div id="explorer-header">
          <span>EXPLORER</span>
          <div class="explorer-actions">
            <button id="new-file" title="New file">+</button>
            <button id="open-folder" title="Open folder">📁</button>
            <button id="collapse-all" title="Collapse">-</button>
            <button id="refresh-explorer" title="Refresh">🔄</button>
          </div>
        </div>
        <div id="folder-path"></div>
        <div id="file-tree"></div>
      </div>
      <div id="container">
        <textarea id="editor" placeholder="Write markdown here..." spellcheck="false"></textarea>
        <div id="preview" class="markdown-body"></div>
      </div>
    </div>
    <div id="footer">
      <span id="word-count">word-count: 0</span>
    </div>
  </div>
  <script src="renderer.js"></script>
</body>
</html>